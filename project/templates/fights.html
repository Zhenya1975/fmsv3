<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">


   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <style>
     a:hover {
      cursor:pointer;
     }
    </style>
    <title>{{ competition_data.competition_name }}. Поединки</title>
</head>
<body>

    <!-- Это начало Nav Bar-->

        <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
          <h5 class="my-0 mr-md-auto font-weight-normal">Fights Management System</h5>
          <nav class="my-2 my-md-0 mr-md-3">
            <a class="p-2 text-dark" href="{{url_for('home.competitions')}}">Соревнования</a>
            <a class="p-2 text-dark" href="{{url_for('home.participants')}}">Спортсмены</a>
          </nav>
        </div>

    <!-- Это конец Nav Bar-->

    <!--<div class="container-fluid" style="margin-top: 10px">-->
    <div class="container" style="margin-top: 10px">
        <div class="row">
            <div class="col">

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    <ul style="padding-left: 0">
                        {% for category, message in messages %}
                        <div class="alert {{category}} alert-dismissible fade show" role="alert">
                            <li style="list-style-type: none;">{{ message }}</li>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        {% endfor %}
                    </ul>
                    {% endif %}
                {% endwith %}


                <p><a href="{{url_for('home.competitions')}}">Список соревнований</a></p>
                <h3>{{ competition_data.competition_name }}. Поединки</h3>
                <div class="d-flex flex-row" style="min-width:780px">
                  <div class="p-2">
                      <div class="form-group">
                          <label for="age_cat_select">Возрастная категория</label>
                          <select style="width:auto;" class="age_category_select form-control" id="age_cat_select" name="age_catagory_selector">
                              {% for age_cat in age_catagories_data %}
                                <option value={{ age_cat.age_cat_id }}>{{ age_cat.age_category_name }}</option>
                              {% endfor %}
                            </select>
                      </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <div class="p-2">
                           <div class="form-group">
                              <label for="weight_cat_select">Весовая категория</label>
                              <select style="width:auto;" class="weight_category_select form-control" id="weight_cat_select" name="weight_catagory_selector">
                                  {% for weight_cat in weight_categories_data %}
                                    <option value={{ weight_cat.weight_cat_id }}>{{ weight_cat.weight_category_name }}</option>
                                  {% endfor %}
                                </select>
                          </div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="p-2">
                        <div class="form-group">
                              <label for="round_select">Круг</label>
                              <select style="width:auto;" class="round_select form-control" id="round_select" name="round_selector">
                                <option value=0 selected disabled>Выбрать круг</option>
<!--                                   {% for weight_cat in weight_categories_data %}
                                    <option value={{ weight_cat.weight_cat_id }}>{{ weight_cat.weight_category_name }}</option>
                                  {% endfor %} -->
                                </select>
                          </div>
                      </div>
                      </div>
                    <div class="col">
                      <div class="p-2 align-self-center">
                        
                        <button style="margin-top: 35px" class="btn btn-sm btn-outline-secondary edit_rounds" id="edit_rounds" type="button" data-compid={{ competition_data.competition_id }}>Круги</button>
                      </div>
                      </div>
                  </div>

                    
                </div>

             



            </div>
        </div>


      <div class="modal fade" id="edit_rounds_modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
              <div class="modal-content">
                    <div class="modal-header">
                          <h5 class="modal-title">Круги</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                          </button>
                    </div>

                    <div class="modal-body">

                    </div>

              </div>
        </div>
      </div>





      
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.min.js"></script>

<script>
    $(document).ready(function(){
        var socket = io.connect();
        var selectedweightcategory = $('#weight_cat_select').children("option:selected").val();
        var selectedagecategory = $('#age_cat_select').children("option:selected").val();
        var selectround = $('#round_select').children("option:selected").val();
        // при загрузке страницы отправляем на сервер значения в селектах 
        // возрастной и весовой категории с тем чтобы обратно получить значения для кругов
        socket.emit('define_rounds_data', {'selectedweightcategory': selectedweightcategory, 'selectedagecategory':selectedagecategory, 'selectround':selectround});

        socket.on('update_round_selector', function (msg){
            var option = $('<option></option>').attr("value", "option value").text("Text");
            
            var rounds_selector_data = msg.rounds_selector_data
            var $el = $("#round_select");
            $('#round_select option:gt(0)').remove();
            $.each(rounds_selector_data, function(key,value) {
              $el.append($("<option></option>")
                 .attr("value", value).text(key));
            });
          })

         $("select.weight_category_select").change(function(){
              $(".round_select").val(0)
             selectedweightcategory = $(this).children("option:selected").val();
            socket.emit('define_rounds_data', {'selectedweightcategory': selectedweightcategory, 'selectedagecategory':selectedagecategory, 'selectround':selectround});
           
           var option = $('<option></option>').attr("value", "option value").text("Text");
           $('#round_select option:gt(0)').remove(); // remove all options, but not the first  
           // $("#round_select").empty().append(option);
        });

      
        $("select.age_category_select").change(function(){
            selectedagecategory = $(this).children("option:selected").val();
            socket.emit('define_rounds_data', {'selectedweightcategory': selectedweightcategory, 'selectedagecategory':selectedagecategory, 'selectround':selectround});
        });


       $('.edit_rounds').click(function(){
           var competition_id = $(this).data('compid');
           $.ajax({
                 url: '/edit_rounds_ajaxfile',
                 type: 'post',
                 data: {competition_id:competition_id, selectedweightcategory:selectedweightcategory,selectedagecategory:selectedagecategory},
                 success: function(data){

                    $('.modal-body').html(data);
                    $('.modal-body').append(data.htmlresponse);
                    $('#edit_rounds_modal').modal('show');
                }
             });

        });
      
    })
</script>


  
</body>